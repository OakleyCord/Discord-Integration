/*
 * This file was generated by the Gradle 'init' task.
 */
plugins {
    id 'java'
    id 'maven-publish'
    id 'com.github.johnrengelman.shadow' version '7.1.2'
}



repositories {
    mavenLocal()
    mavenCentral()

    maven {
        url = uri('https://repo.papermc.io/repository/maven-public/')
    }
}

def getGitHash = { ->
    def stdout = new ByteArrayOutputStream()
    exec {
        commandLine 'git', 'rev-parse', '--short', 'HEAD'
        standardOutput = stdout
    }
    return stdout.toString().trim()
}

group = 'dev.oakleycord'
version = enviorment.equalsIgnoreCase("dev") ? getGitHash() :  version
description = 'DiscordIntegration'
java.sourceCompatibility = JavaVersion.VERSION_17

configurations {
    embed
    compileOnly.extendsFrom embed
}





shadowJar {
    archiveClassifier = "${project.minecraftVersion}"
    configurations = [project.configurations.embed]
}

artifacts {
    archives tasks.shadowJar
}

dependencies {

    embed('net.dv8tion:JDA:5.0.0-beta.1') {
        exclude module: 'opus-java'
    }
    embed 'club.minnced:discord-webhooks:0.8.2'
    embed('org.plusmc:PlusLib-Core:1.3.2-INDEV') {
        exclude module: 'mongo-java-driver'
        exclude module: 'morphia'
    }
    compileOnly 'io.papermc.paper:paper-api:1.19.2-R0.1-SNAPSHOT'
}

processResources {
    inputs.property "version", project.version

    filesMatching('plugin.yml') {
        expand 'version': project.version
    }
}

tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8'
}
